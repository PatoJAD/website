{{/* Partial: components/card-metro.html
   Expects a dict: { "page": <page> }
*/}}
{{ $p := .page }}
<article class="rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-800 w-full h-full flex flex-col">
  <a href="{{ $p.RelPermalink }}" class="block group flex-1">
    <div class="relative overflow-hidden shadow-lg h-full flex flex-col">
      <div class="relative flex-1 min-h-[220px] sm:min-h-[260px] md:min-h-[320px]">
        <img src="{{ $p.Params.img }}" alt="{{ $p.Title }}" title="{{ $p.Title }}" loading="lazy" decoding="async" class="absolute inset-0 w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-95 group-hover:opacity-100 transition"></div>

        <div class="absolute left-4 bottom-4 right-4 flex items-end justify-between gap-3">
          <div class="flex flex-col max-w-[65%]">
            <h3 class="text-white text-lg sm:text-xl font-bold leading-tight drop-shadow">{{ $p.Title }}</h3>
            <div class="mt-1 flex gap-2 flex-wrap">
              {{ if $p.Params.categories }}
                {{ range ($p.GetTerms "categories") }}
                  {{ $cat := . }}
                  {{ with .Params.style }}
                    <span class="text-xs px-3 py-1 rounded-full card-cat-badge" style="--cat-bg: {{ .background }}; --cat-color: {{ .color }};">{{ $cat.LinkTitle }}</span>
                  {{ else }}
                    <span class="text-xs px-3 py-1 rounded-full card-cat-badge">{{ $cat.LinkTitle }}</span>
                  {{ end }}
                {{ end }}
              {{ end }}
            </div>
          </div>

          <div class="flex items-center gap-2">
            {{ $sitePages := $p.Site.Pages.ByPublishDate.Reverse }} {{ range $p.Params.authors }} {{ range where (where $sitePages "Type" "authors") ".Params.name" . }}
              <div class="flex items-center gap-2 bg-white/10 rounded-full px-3 py-1 backdrop-blur">
                <img class="w-8 h-8 rounded-full object-cover" src="{{ .Params.photo }}" alt="{{ .Params.name }}">
                <span class="text-sm text-white">{{ .Params.name }}</span>
              </div>
            {{ end }}{{ end }}
          </div>
        </div>
      </div>
    </div>
  </a>

  <div class="mt-3 flex items-center justify-between px-2 sm:px-4">
    <div class="flex items-center gap-2 text-xs text-gray-500">
      <span class="flex items-center gap-1"><em class="fa fa-clock-o" aria-hidden="true"></em>{{ $p.ReadingTime }} min</span>
      <span class="flex items-center gap-1"><em class="fa fa-calendar" aria-hidden="true"></em>
        {{ $formattedDate := $p.Date.Format "Friday, March 3, 2006" }}
        {{ $monthNumber := $p.Date.Month }} {{ $dayNumber := $p.Date.Weekday }}
        {{ if eq site.Language.Lang "es" }}
        {{ $monthNumber = index site.Data.meses (printf "%d" $p.Date.Month) }}
        {{ $dayNumber = index site.Data.dias (printf "%d" $p.Date.Weekday) }}
        {{ $formattedDate = delimit (slice $dayNumber (printf "%d" $p.Date.Day) "de" $monthNumber "de" (printf "%d" $p.Date.Year)) " "}}
        {{ end }}
        {{ $formattedDate }}
      </span>
    </div>

    <div class="mb-2">
      <a href="{{ $p.RelPermalink }}" class="inline-flex items-center gap-2 bg-amber-500 text-white text-xs px-3 py-2 rounded-xl hover:bg-amber-600 transition">Leer artículo <span class="hidden sm:inline">→</span></a>
    </div>
  </div>
</article>
